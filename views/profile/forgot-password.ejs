<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password - AlisterBank</title>
    <link rel="stylesheet" href="/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <%- include('../header') %>

    <main
      style="
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        background: var(--bg-secondary);
      "
    >
      <div class="auth-container">
        <section class="form-section active" id="forgotPasswordForm">
          <h2>Forgot Password</h2>
          <p>Enter your email address and we'll send you a link to reset your password</p>

          <% if (success && success.length > 0) { %>
            <div class="alert alert-success">
              <%= success[0] %>
            </div>
          <% } %>
          <% if (error && error.length > 0) { %>
            <div class="alert alert-error">
              <%= error[0] %>
            </div>
          <% } %>

          <div id="message-container"></div>

          <form id="forgotPasswordFormElement">
            <div class="input-group">
              <label for="email">Email Address</label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="Enter your email"
                required
              />
            </div>

            <button type="submit" class="btn" id="submitBtn">Send Reset Link</button>
          </form>

          <div class="switch-text">
            Remember your password? <a href="/login">Sign In</a>
          </div>
        </section>

        <aside class="side-panel">
          <svg
            width="80"
            height="80"
            viewBox="0 0 40 40"
            fill="none"
            style="margin-bottom: 2rem"
          >
            <rect width="40" height="40" rx="8" fill="rgba(255,255,255,0.2)" />
            <path d="M20 8L32 14V18H8V14L20 8Z" fill="white" />
            <rect x="10" y="20" width="4" height="12" fill="white" />
            <rect x="18" y="20" width="4" height="12" fill="white" />
            <rect x="26" y="20" width="4" height="12" fill="white" />
            <rect x="8" y="32" width="24" height="3" fill="white" />
          </svg>
          <h3>Need Help?</h3>
          <p>
            If you're having trouble accessing your account, our support team is here to help.
          </p>
          <a href="/login" class="switch-btn">Back to Login</a>
        </aside>
      </div>
    </main>

    <%- include('../footer') %>

    <script>
      document.getElementById('forgotPasswordFormElement').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('submitBtn');
        const messageContainer = document.getElementById('message-container');
        const email = document.getElementById('email').value;

        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        messageContainer.innerHTML = '';

        try {
          const response = await fetch('/forgot-password', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          if (data.success) {
            messageContainer.innerHTML = '<div class="alert alert-success">' + data.message + '</div>';
            document.getElementById('email').value = '';
          } else {
            messageContainer.innerHTML = '<div class="alert alert-error">' + data.message + '</div>';
          }
        } catch (error) {
          messageContainer.innerHTML = '<div class="alert alert-error">Something went wrong. Please try again.</div>';
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Send Reset Link';
        }
      });
    </script>
  </body>
</html>
